Automated Item Generation Using GPT-3
================

This code is written in **Python** as an illustration of how personality
items may be generated by GPT-3 ([Brown et al.,
2020](https://arxiv.org/abs/2005.14165)). *Remember* you will need to
register for an API key on OpenAI’s website
[here](https://beta.openai.com/). There are also several open source
versions available; however, they’ve yet to acheive GPT-3’s level of
performance.

#### Opening this notebook in Google Colab

This guide has been written for use *Google Colab*. Those that wish to
run the code locally must install the python modules in the
**Libraries** section below. Please see how to install python modules
[here](https://docs.python.org/3/installing/index.html).

[![Open In
Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/drive/1XbVgv15pRsaaVHyV19ON9wRdx19PxgU7?usp=sharing)

### Libraries

Colab comes with a large number of Python libraries pre-loaded. However,
`openai` is not one of those libraries. The `openai` library can be
installed by using the code below.

``` python
#@title Installing openai

## Uncomment command below to install openai
! pip install openai
```

#### Import Libraries

``` python
import os
import openai
import math # for ceiling
```

##### Enter API Key

``` python
# this can be stored as an environmental variable (if local)
# openai.api_key = os.getenv("OPENAI_API_KEY")
# or manually entered
openai.api_key = "<INSERT API KEY HERE>"
```

------------------------------------------------------------------------

### Fine-Tune GPT-3 Using Prompt Engineering

------------------------------------------------------------------------

*Prompt engineering* allows us to give GPT-3 a few examples which we can
pass as a string.

#### Creating Custom Prompt

We can first make a tempate then we will ask for different items of
different traits by adding two variables: `aig_trait` and
`aig_num_items`. However, we need to make sure we adjust `max_tokens`
otherwise GPT-3 will start to rant.

``` python
#@title Specify the number and type of items to generate
aig_num_items = 15
aig_trait = "extraversion"
average_tkn_len = 15
```

``` python
#@title Specify the number and type of items to generate
# create our prompt based on the variables specified above
custom_prompt = f"Objective: This program generates items that measure Big Five personality traits.\n\ntrait: neuroticism\nnumber of items to generate: 6\n1. I dislike myself .\n2. I am someone who stays optimistic after experiencing a setback .\n3. I panic easily .\n4. I suspect that my facial expressions give me away when I feel sad .\n5. I am not easily bothered by things .\n6. I seldom feel blue .\n###\ntrait: openness\nnumber of item to generate: 4\n1. Others perceive that I do not have original ideas, and I am not inventive .\n2. I have a vivid imagination .\n3. I am someone who avoids intellectual philosophical discussions .\n4. I do not enjoy watching dance performances .\n###\ntrait: agreeableness\nnumber of items to generate: 2\n1. I become frustrated and angry with people when they don't live up to my expectations .\n2. When interacting with a group of people, am often bothered by at least one of them .\n###\ntrait: {aig_trait}\nnumber of items to generate: {aig_num_items}\n1."
```

Here is what our custom prompt now looks like:

    ## Objective: This program generates items that measure Big Five personality traits.
    ## 
    ## trait: neuroticism
    ## number of items to generate: 6
    ## 1. I dislike myself .
    ## 2. I am someone who stays optimistic after experiencing a setback .
    ## 3. I panic easily .
    ## 4. I suspect that my facial expressions give me away when I feel sad .
    ## 5. I am not easily bothered by things .
    ## 6. I seldom feel blue .
    ## ###
    ## trait: openness
    ## number of item to generate: 4
    ## 1. Others perceive that I do not have original ideas, and I am not inventive .
    ## 2. I have a vivid imagination .
    ## 3. I am someone who avoids intellectual philosophical discussions .
    ## 4. I do not enjoy watching dance performances .
    ## ###
    ## trait: agreeableness
    ## number of items to generate: 2
    ## 1. I become frustrated and angry with people when they don't live up to my expectations .
    ## 2. When interacting with a group of people, am often bothered by at least one of them .
    ## ###
    ## trait: extraversion
    ## number of items to generate: 15
    ## 1.

We outline the specifics of this analysis in the paper. However, we now
will ask GPT-3 to generate a `completion` based on our custom prompt.
Here we as for a `completion` that is `average_tkn_len` tokens per item
specified (`aig_num_items`).

``` python
# Call GPT-3
response = openai.Completion.create(
  engine="davinci",
  prompt = custom_prompt,
  temperature=0.7,
  max_tokens= math.ceil(aig_num_items * average_tkn_len),
  top_p=0.9,
  frequency_penalty=0.5,
  presence_penalty=0.5,
  stop=["###"],
)
```

#### More Examples

We can change our trait to be something other individual
difference….maybe *leadership*

``` python
# here we ask for 20 leadership items
aig_num_items = 20
aig_trait = "leadership"
average_tkn_len = 15
```

``` python
# replace our prompt
custom_prompt = f"Objective: This program generates items that measure Big Five personality traits.\n\ntrait: neuroticism\nnumber of items to generate: 6\n1. I dislike myself .\n2. I am someone who stays optimistic after experiencing a setback .\n3. I panic easily .\n4. I suspect that my facial expressions give me away when I feel sad .\n5. I am not easily bothered by things .\n6. I seldom feel blue .\n###\ntrait: openness\nnumber of item to generate: 4\n1. Others perceive that I do not have original ideas, and I am not inventive .\n2. I have a vivid imagination .\n3. I am someone who avoids intellectual philosophical discussions .\n4. I do not enjoy watching dance performances .\n###\ntrait: agreeableness\nnumber of items to generate: 2\n1. I become frustrated and angry with people when they don't live up to my expectations .\n2. When interacting with a group of people, am often bothered by at least one of them .\n###\ntrait: {aig_trait}\nnumber of items to generate: {aig_num_items}\n1."
```

Here is what our new custom prompt now looks like:

    ## Objective: This program generates items that measure Big Five personality traits.
    ## 
    ## trait: neuroticism
    ## number of items to generate: 6
    ## 1. I dislike myself .
    ## 2. I am someone who stays optimistic after experiencing a setback .
    ## 3. I panic easily .
    ## 4. I suspect that my facial expressions give me away when I feel sad .
    ## 5. I am not easily bothered by things .
    ## 6. I seldom feel blue .
    ## ###
    ## trait: openness
    ## number of item to generate: 4
    ## 1. Others perceive that I do not have original ideas, and I am not inventive .
    ## 2. I have a vivid imagination .
    ## 3. I am someone who avoids intellectual philosophical discussions .
    ## 4. I do not enjoy watching dance performances .
    ## ###
    ## trait: agreeableness
    ## number of items to generate: 2
    ## 1. I become frustrated and angry with people when they don't live up to my expectations .
    ## 2. When interacting with a group of people, am often bothered by at least one of them .
    ## ###
    ## trait: leadership
    ## number of items to generate: 20
    ## 1.

``` python
# Call GPT-3
response_leadership = openai.Completion.create(
  engine="davinci",
  prompt = custom_prompt,
  temperature=0.7,
  max_tokens= math.ceil(aig_num_items * average_tkn_len),
  top_p=0.9,
  frequency_penalty=0.5,
  presence_penalty=0.5,
  stop=["###"],
)
```
